<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns="http://www.springframework.org/schema/webflow"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow-1.0.xsd">

	<start-state idref="notebookList"/>

	<view-state id="notebookList" view="notebookList">
	
		<!-- Find all notebooks before displaying the notebook list -->
		<render-actions>
			<bean-action bean="notebookService" method="findNotebooks">
				<method-result name="notebooks"/>
			</bean-action>
		</render-actions>
	
		<!-- Viewing a notebook: call findNotebook(id) and pass result as "notebook" -->
		<transition on="view" to="notebookDetails">
			<bean-action bean="notebookService" method="findNotebook">
				<method-arguments>
					<argument expression="flowScope.notebook-id"/>
				</method-arguments>
				<method-result name="notebook"/>
			</bean-action>				
		</transition>

		<!-- Creating a notebook: create notebook with current user as owner. -->		
		<transition on="create" to="notebookDetails">
			<bean-action bean="notebookService" method="createNotebook">
				<method-arguments>
					<argument expression="flowScope.notebook-id"/>
				</method-arguments>
				<method-result name="notebook"/>
			</bean-action>				
		</transition>
		
		<!-- Deleteing a notebook -->
		<transition on="delete" to="listNotebooks">
			<bean-action bean="notebookService" method="deleteNotebook">
				<method-arguments>
					<argument expression="flowScope.notebook-id"/>
				</method-arguments>
			</bean-action>		
		</transition>
		
		<transition on="logout" to="..."/>
	</view-state>

	<view-state id="notebookDetails" view="notebookDetails">
		<transition on="add" to="notebookDetails"></transition>
		<transition on="remove" to="notebookDetails"/>
		<transition on="share" to="notebookGrants"/>
	</view-state>
	
	<view-state id="notebookGrants" view="notebookGrants">
		<transition on="ok" to="notebookDetails"/>
		<transition on="cancel" to="notebookDetails"/>
	</view-state>
	
	<import resource="notebook-flow-beans.xml"/>
</flow>